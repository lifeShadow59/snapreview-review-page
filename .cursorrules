# Project Structure & Authentication Rules

This document outlines the recommended project structure and authentication implementation guidelines. Adhering to these conventions will help maintain a clean, scalable, and easy-to-navigate codebase.

## ğŸ” Authentication Routes (IMPORTANT - Always Use These Paths)

- **Sign In Page**: `/auth/login` (http://localhost:3000/auth/login)
- **Registration Page**: `/auth/register` (http://localhost:3000/auth/register)
- **Dashboard**: `/dashboard` (protected route)

**NEVER use `/auth/signin` or `/auth/signup` - these are deprecated paths!**

## Directory Overview

```
review-frontend/
â”œâ”€â”€ .vscode/                  # Workspace settings (e.g., for recommended extensions)
â”œâ”€â”€ public/                   # Static assets (images, fonts, etc.)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router: pages, layouts, and route handlers
â”‚   â”‚   â”œâ”€â”€ (main)/           # Example route group for authenticated app pages
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/ # Components specific to the dashboard
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Chart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ api/              # API routes (route handlers)
â”‚   â”‚   â””â”€â”€ layout.tsx        # Root layout
â”‚   â”‚
â”‚   â”œâ”€â”€ components/           # Shared components used across the application
â”‚   â”‚   â”œâ”€â”€ ui/               # Basic, reusable UI elements (Button, Input, Card)
â”‚   â”‚   â””â”€â”€ common/           # More complex components composed of UI elements
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                  # Utility functions, helpers, and constants
â”‚   â”œâ”€â”€ hooks/                # Custom React hooks
â”‚   â”œâ”€â”€ services/             # Data fetching logic (e.g., API clients)
â”‚   â”œâ”€â”€ store/                # State management (Zustand, Redux, etc.)
â”‚   â””â”€â”€ types/                # Global TypeScript types and interfaces
â”‚
â”œâ”€â”€ .editorconfig             # Consistent editor settings
â”œâ”€â”€ .eslintrc.js              # ESLint configuration
â”œâ”€â”€ next.config.mjs           # Next.js configuration
â””â”€â”€ tsconfig.json             # TypeScript configuration
```

## Key Principles

1.  **Feature-Colocation in `app/`**: For any given page or route in the `app` directory, its specific components should be co-located within a `components` sub-directory. This keeps feature-specific logic self-contained.

2.  **Shared Components in `src/components/`**:

    - `src/components/ui/`: Contains highly reusable, "dumb" UI components like `Button`, `Input`, `Dialog`. These should be generic and application-agnostic.
    - `src/components/common/`: Contains components that are shared across multiple features but might have more business logic than simple UI components.

3.  **Route Groups `(...)`**: Use route groups in the `app` directory to organize sections of your application (e.g., `(auth)`, `(marketing)`, `(main)`) without affecting the URL structure.

4.  **Clear Separation of Concerns**:
    - `lib`: For pure functions and utilities.
    - `hooks`: For custom React hook logic.
    - `services`: For abstracting data-fetching.
    - `store`: For global state.
    - `types`: For shared type definitions.

By following this structure, the project will be easier to understand and maintain as it grows.

## API Route Structure

API routes are defined using Route Handlers within the `src/app/api/` directory. This approach allows you to create backend endpoints for your application.

### 1. Basic Structure

Each API endpoint is a `route.ts` (or `.js`) file that exports functions corresponding to HTTP methods.

**Example: `src/app/api/users/route.ts`**

```typescript
// src/app/api/users/route.ts
import { NextResponse } from "next/server";

// Handles GET requests to /api/users
export async function GET() {
  // Logic to fetch users from a database
  const users = [{ id: 1, name: "John Doe" }];
  return NextResponse.json({ users });
}

// Handles POST requests to /api/users
export async function POST(request: Request) {
  // Logic to create a new user
  const data = await request.json();
  return NextResponse.json({ message: "User created", data }, { status: 201 });
}
```

### 2. Dynamic API Routes

For dynamic segments in your API paths (e.g., fetching a user by ID), use brackets `[]` in the directory name.

**Example: `src/app/api/users/[userId]/route.ts`**

```typescript
// src/app/api/users/[userId]/route.ts
import { NextResponse } from "next/server";

export async function GET(
  request: Request,
  { params }: { params: { userId: string } }
) {
  const userId = params.userId;
  // Logic to fetch user by ID
  return NextResponse.json({ userId, name: `User ${userId}` });
}
```

This structure helps in keeping your API clean, organized, and easy to maintain.

## Database Connection

This project uses PostgreSQL for the database. Follow these steps to connect your local environment.

### 1. Environment Variables

Create a `.env.local` file in the root of the project. This file is for local development and should not be committed to version control. Add your database credentials to this file:

```bash
# .env.local
POSTGRES_HOST=your_host
POSTGRES_USER=your_username
POSTGRES_PASSWORD=your_password
POSTGRES_DATABASE=your_dbname
POSTGRES_PORT=5432 # Or your custom port
```

**Note:** You must restart the development server after creating or modifying the `.env.local` file.

## ğŸ” Authentication Implementation Rules

### Route Naming Convention
- **Login/Sign-in**: Always use `/auth/login` 
- **Registration/Sign-up**: Always use `/auth/register`
- **Dashboard**: Always use `/dashboard` for authenticated users

### File Structure for Authentication
```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login/page.tsx        # Sign-in page
â”‚   â”‚   â””â”€â”€ register/page.tsx     # Registration page
â”‚   â”œâ”€â”€ dashboard/page.tsx        # Protected dashboard
â”‚   â””â”€â”€ api/auth/
â”‚       â”œâ”€â”€ [...nextauth]/route.ts    # NextAuth.js handlers
â”‚       â””â”€â”€ register/route.ts         # Registration API
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ auth.ts                   # NextAuth.js configuration
â”œâ”€â”€ middleware.ts                 # Route protection
â””â”€â”€ components/
    â”œâ”€â”€ auth/AuthButton.tsx      # Authentication button component
    â””â”€â”€ providers/SessionProvider.tsx  # Session provider wrapper
```

### Authentication Guidelines
1. **Always use NextAuth.js** for authentication logic
2. **JWT sessions only** (no database sessions for edge compatibility)
3. **Protect routes** using middleware with getToken() for edge runtime
4. **Hash passwords** using bcryptjs (12 rounds minimum)
5. **Validate forms** on both client and server side
6. **Handle errors gracefully** with user-friendly messages
7. **Use loading states** during authentication operations

### Link References
- Navigation links should point to `/auth/login` and `/auth/register`
- Redirect URLs should use `/dashboard` for authenticated users
- Error redirects should use `/auth/login` for unauthenticated access

### 2. Connection Utility

The database connection is managed by a connection pool located at `src/lib/db.ts`. This utility reads the environment variables from `.env.local` to establish the connection.

### 3. Testing the Connection

To verify that your database connection is configured correctly, run the application and navigate to the `/api/db-test` endpoint. A successful connection will return a JSON object with the current timestamp from the database.
